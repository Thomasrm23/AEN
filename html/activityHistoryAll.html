<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

	<title>AEN</title>

	<link href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,700" rel="stylesheet">

	<link rel="stylesheet" href="../css/linearicons.css">
	<link rel="stylesheet" href="../css/font-awesome.min.css">
	<link rel="stylesheet" href="../css/bootstrap.css">
	<link rel="stylesheet" href="../css/magnific-popup.css">
	<link rel="stylesheet" href="../css/nice-select.css">
	<link rel="stylesheet" href="../css/animate.min.css">
	<link rel="stylesheet" href="../css/owl.carousel.css">
	<link rel="stylesheet" href="../css/jquery-ui.css">
	<link rel="stylesheet" href="../css/main.css">


</head>
<body>

	<header id="header">

	</header>
	<section class="banner-area relative about-banner" id="home">
		<img class="cta-img img-fluid" src="img/cta-img.png" alt="">
		<div class="overlay overlay-bg"></div>
		<div class="container">
			<div class="row d-flex align-items-center justify-content-center">
				<div class="about-content col-lg-12">
					<h1>
						Planifier les activités
					</h1>
					<p class="link-nav"><a href="index.html">Accueil </a>
						<span class="lnr lnr-arrow-right"></span> <a href="activityHistoryAll.html">
						  Planifier les activités </a></p>
				</div>
			</div>
		</div>
	</section>
	<section class="contact-page-area section-gap">
		<div class="container">
			<div class="row justify-content-center">

        <div class="table-wrap col-lg-10">
					<table class="schdule-table table table-bordered">
						<thead class="thead-light">
              <th class="head" scope="col">Identifiant activité</th>
              <th class="head" scope="col">Identifiant membre</th>
              <th class="head" scope="col">Activités</th>
              <th class="head" scope="col">Utilisation</th>
              <th class="head" scope="col">Temps (heures)</th>
              <th class="head" scope="col">date de début</th>
              <th class="head" scope="col">date de fin</th>
              <th class="head" scope="col">Un instructeur ????</th>
              <th class="head" scope="col">Instructeur</th>
              <th class="head" scope="col">Engin</th>
						</thead>
            <tbody class="show-activity-hide">
            </tbody>

				  </table>
			  </div>
      </div>
		</div>
	</section>
	<footer>

	</footer>

	<script src="../jquery/jquery-3.2.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
	 crossorigin="anonymous"></script>
	<script src="../js/vendor/bootstrap.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhOdIF3Y9382fqJYt5I_sswSrEw5eihAA"></script>

	<script src="../js/easing.min.js"></script>
	<script src="../js/hoverIntent.js"></script>
	<script src="../js/superfish.min.js"></script>
	<script src="../js/jquery.ajaxchimp.min.js"></script>
	<script src="../js/jquery.magnific-popup.min.js"></script>
	<script src="../js/jquery.tabs.min.js"></script>
	<script src="../js/jquery.nice-select.min.js"></script>
	<script src="../js/owl.carousel.min.js"></script>
  <script src="../js/main.js"></script>

 <script src="../js/isCo.js">

 </script>

	<script type="text/javascript">
  window.onload = function go(){
    getActivityAll();
};

  function getActivityAll(){

    var options = {
        url: "../api/activity/getActivityAll.php",
        dataType: "text",
        type: "POST",

        success: function( data, status, xhr){
          //  console.log(JSON.parse(xhr.responseText));
            showActivityAll(JSON.parse(xhr.responseText));
              },
        error: function(xhr, status, error){

        }
    };
    $.ajax(options);
}

function showActivityAll(activity){

        let divHide = $('.show-activity-hide');
        let element;
        for(let i = 0; i < Object.keys(activity).length; i++){
            addActivity(activity[i], i);

        }

    }


    function addActivity(activity, n){
      console.log('ok');
      console.log(activity);
      console.log('ok');
     let  element = ' <tr>' +
    //  ' <td class="col date-activity" id="date-activity-' + activity['dateRequested'] + '" name="' + activity['dateRequested'] + '"> <b>' + activity["dateRequested"] +'</b></td>' +
    ' <td class="col idMember-activity" id="idMember-activity-' + activity['idActivity'] + '" name="' + activity['idActivity'] + '"> <b>' + activity["idActivity"] +'</b></td>' +
    ' <td><input type="number" id="idActivity-' + activity['idActivity'] + '" value="' + activity['idActivity'] + '" readonly></td>' +
    ' <td class="col idMember-activity" id="idMember-activity-' + activity['idMember'] + '" name="' + activity['idMember'] + '"> <b>' + activity["idMember"] +'</b></td>' +
    ' <td class="col name-activityType" id="name-activity-type' + activity['nameActivityType'] + '" name="' + activity['nameActivityType'] + '"> <b>' + activity["nameActivityType"] +'</b></td>' +
    ' <td class="col utility-activity" id="utility-activity-' + activity['utility'] + '" name="' + activity['utility'] + '"> <b>' + activity["utility"] +'</b></td>' +
    ' <td class="col nbHours-activity" id="nbHours-activity-' + activity['nbHours'] + '" name="' + activity['nbHours'] + '"> <b>' + activity["nbHours"] +'</b></td>' +
    ' <td><input type="datetime-local" class="dateBegin" name="dateBegin" id="dateBegin"></td>' +
    ' <td><input type="datetime-local" class="dateEnd" name="dateEnd" id="dateEnd"></td>' +
    //' <td class="col instructorNeeded-activity" id="instructorNeeded-activity-' + activity['instructorNeeded'] + '" name="' + activity['instructorNeeded'] + '"> <b>' + activity["instructorNeeded"] +'</b></td>' +
    // ' <td class="col instructorNeeded-activity" id="instructorNeeded-activity-' + activity['instructorNeeded'] + '" name="' + activity['instructorNeeded'] + '"> <b>' + activity["instructorNeeded"] === 1 ? 'OUI' : 'NON' +'</b></td>' +
    //' <td><select type="text" name="instructor" id="instructorList-'+n+'"><option value="">Choix instructeur</option></select></td>' +
  //  ' <td><select type="text" name="aircraft" id="aircraftList-' + n + '"><option value="">Choix engin</option></select></td>' +
//    ' <td class="col booked-activity" id="booked-activity-' + activity['booked'] + '" name="' + activity['booked'] + '"> <b>' + activity["booked"] +'</b></td>' +
' <td><button class="col validate-activity" id="submit">Valider</button></td>' +
//' <td><input type="button" class="col intervention-activity" href="" onclick="updateActivity(' + activity['idActivity'] + ')" value="Valider"></td>' +
//' <td><input type="button" class="col intervention-activity" href="" onclick="updateActivity(' + activity['idActivity'] + ',' + activity['dateBegin'] + ',' + activity['dateEnd'] + ')" value="Valider"></td>' +
//' <td><input type="button" class="col intervention-activity" href="" onclick="updateActivity(' + activity['idActivity'] + ',' + aircraft[i]['idAircraft'] + ',' + instructor[i]['idInstructor'] + ',' + activity['dateBegin'] + ',' + activity['dateEnd'] + ')" value="Valider"></td>' +
  ' <td><input type="button" class="col intervention-activity" href="" onclick="" value="Supprimer"></td>' +

    ' </tr>'

    $('.show-activity-hide').append(element);
    getInstructor(n);

}

function getInstructor(n) {


            var option = {
              url: '../api/activity/getInstructor.php',
                dataType: "text",
                type: "POST",
                data: {},
                success: function(data, status, xhr){
                    let instructor = JSON.parse(xhr.responseText);
                    let optionElement;
                    for ( let i = 0; i < instructor.length; i++){
                        optionElement = document.createElement("option");
                        optionElement.setAttribute( "value", instructor[i]['idInstructor']);
                        optionElement.innerHTML = instructor[i]['name'];
                        console.log(instructor);
                        // switch (n) {
                        //   case 0:
                        //     $('#instructorList-0').append(optionElement);
                        //     break;
                        //     case 1:
                        //       $('#instructorList-1').append(optionElement);
                        //       break;
                        //       case 2:
                        //         $('#instructorList-2').append(optionElement);

                        $('#instructorList-'+n+'');
                    //    $("#instructorList-"[n]).append(optionElement);
                        console.log(n);
                      //  }
                    }
                  getAircraft(n);
                },
                error: function( xhr, status, error ){

                }
            };
            $.ajax(option);
        };

        function getAircraft(n) {


                    var option = {
                      url: '../api/activity/getAircraft.php',
                        dataType: "text",
                        type: "POST",
                        data: {},
                        success: function(data, status, xhr){
                            let aircraft = JSON.parse(xhr.responseText);
                            let optionElement;
                            for ( let i = 0; i < aircraft.length; i++){
                                optionElement = document.createElement("option");
                                optionElement.setAttribute( "value", aircraft[i]['idAircraft']);
                                optionElement.innerHTML = aircraft[i]['name'];
                                switch (n) {
                                  case 0:
                                    $('#aircraftList-0').append(optionElement);
                                    break;
                                    case 1:
                                      $('#aircraftList-1').append(optionElement);
                                      break;
                                      case 2:
                                        $('#aircraftList-2').append(optionElement);
                                }

                                console.log();
                            }
                        },
                        error: function( xhr, status, error ){

                        }
                    };
                    $.ajax(option);
                };

                $(function(){

                  // Ecoute de la soumission du formulaire
                  $(document).on('click','#submit' ,function(event){
                    event.preventDefault();

                // function updateActivity(idActivity, dateBegin, dateEnd){
              //  function updateActivity(idActivity, dateBegin, dateEnd){
                        var data = {
                          dateBegin: $('#id').val(),
                            dateBegin: $('#dateBegin').val(),
                            dateEnd: $('#dateEnd').val()
                        };

                        $.ajax({
                            url: "../api/activity/updateActivity.php",
                            dataType: "text",
                            type: "POST",
                            data: { data: JSON.stringify( data ) },
                            success: function( data, status, xhr ) {
                                console.log("successss");
                  //              console.log(JSON.parse(data));
                          //      console.log(JSON.parse(xhr.responseText));

                                // successAcceptIntervention();
                                // setTimeout(function(){
                                //     $('.response-box').html(' ');
                                // }, 4000);

                            },
                            error: function( xhr, status, error ) {
                                console.log("mince");
                                console.log(JSON.parse(data));
                                console.log(JSON.parse(xhr.responseText));

                            }
                        })
                      })
                    })




	</script>

</body>
</html>
